<ons-page ng-controller="PatientTestResultsByDatetimeController as testsByDate">

    <!-- TOOLBAR -->
    <ons-toolbar fixed-style>
        <div class="left">
            <ons-back-button>{{"BACK"|translate}}</ons-back-button>
        </div>
        <div class="center" ng-class="fontSizeTitle">{{testsByDate.testDate|date:'medium'}}</div>
        <div class="right">
            <ons-toolbar-button
                ng-click="personalNavigator.pushPage('views/personal/test-results/test-results-info.html')">
                <ons-icon icon="fa-info-circle"></ons-icon>
            </ons-toolbar-button>
        </div>
    </ons-toolbar>
    <loading-spinning-circle ng-show="testsByDate.loading" loading-message="{{'LOADINGLABRESULTS'|translate}}">
    </loading-spinning-circle>

    <div ng-if="!testsByDate.loading">
        <!-- STICKY HEADER -->
        <div style="position:sticky; top:0; z-index:9999;">
            <!-- SEARCH BAR -->
            <search-bar search-text="testsByDate.searchText" placeholder="{{'SEARCH'|translate}}"
                style-class="fontSizeDesc">
            </search-bar>
            <!-- HEADER WITH COLUMN TITLES -->
            <ons-list>
                <ons-list-item class="list-item-container" style="padding:10px">
                    <ons-row ng-class="fontSizeDesc" style="font-weight:bold" vertical-align="center">
                        <!-- HEADER - LEFT (NAME) -->
                        <ons-col width="35%" class="labtest-col" vertical-align="center">
                            <div align="left" style="margin-left:4px">
                                {{"LAB_NAME"|translate}}
                            </div>
                        </ons-col>

                        <!-- HEADER - CENTRE (VALUE) -->
                        <ons-col width="30%" class="labtest-col" vertical-align="center">
                            <div align="center">
                                {{"LAB_YOUR_RESULT"|translate}}
                            </div>
                        </ons-col>

                        <!-- HEADER - RIGHT (NORMAL RANGE) -->
                        <ons-col width="33%" class="labtest-col" vertical-align="center">
                            <div align="right">
                                {{"LAB_NORM"|translate}}
                            </div>
                        </ons-col>

                        <!-- HEADER - SPACE FOR CHEVRON -->
                        <ons-col width="5%" class="labtest-col" vertical-align="center">
                            <div align="right">

                            </div>
                        </ons-col>
                    </ons-row>
                </ons-list-item>
            </ons-list>
        </div>
        <!-- LIST OF LAB RESULTS -->
        <ons-scroller  set-ons-scroller-height="125">
            <ons-list ng-class="fontSizeDesc">
                <div ng-repeat="testResult in testsByDate.results | filter: testsByDate.searchText">
                    <ons-list-header ng-class="fontSizeDesc" ng-if="testsByDate.showGroupHeader($index)">
                        {{testsByDate.getDisplayedGroupName(testResult.groupName)}}
                    </ons-list-header>
                    <ons-list-item modifier="tappable chevron"
                        ng-click="testsByDate.goToTestTypeResults(testResult.testExpressionSerNum)"
                        class="list-item-container">
                        <ons-row ng-class="[testsByDate.getTestClass(testResult), fontSizeDesc]"
                            vertical-align="center">
                            <!-- LAB RESULT - LEFT (NAME AND UNIT) -->
                            <ons-col width="35%" class="labtest-col" vertical-align="center">
                                <div align="left" style="margin-left:4px">
                                    {{testsByDate.getTestName(testResult)}}
                                </div>
                            </ons-col>

                            <!-- LAB RESULT - CENTRE (VALUE) -->
                            <ons-col width="25%" class="labtest-col" vertical-align="center">
                                <div align="center">
                                    {{testResult.testValue}}
                                    <span ng-if="testResult.abnormalFlag">
                                        ({{testResult.abnormalFlag}})
                                    </span>
                                    <div>
                                        ({{testResult.unitDescription}})
                                    </div>
                                </div>
                            </ons-col>

                            <!-- LAB RESULT - RIGHT (NORMAL RANGE) -->
                            <ons-col width="33%" class="labtest-col" vertical-align="center">
                                <div align="right">
                                    {{testResult.normalRange}}
                                    <div>
                                        ({{testResult.unitDescription}})
                                    </div>
                                </div>
                            </ons-col>
                            <!-- LAB RESULT - SPACE FOR CHEVRON -->
                            <ons-col width="5%" class="labtest-col" vertical-align="center">
                            </ons-col>
                        </ons-row>
                    </ons-list-item>
                </div>
            </ons-list>
        </ons-scroller>
    </div>
</ons-page>