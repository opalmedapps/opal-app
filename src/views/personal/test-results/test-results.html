<ons-page ng-controller="PatientTestResultsController as tests">
    <generic-toolbar title="{{'LAB_RESULTS'|translate}}" style-class="fontSizeTitle">
        <right-content>
            <labs-info-button style="margin-right: -10px"></labs-info-button>
            <ons-toolbar-button ng-click="tests.refresh()">
                <ons-icon icon="ion-ios-refresh-empty" size="2x" style="color: #4F81BB"></ons-icon>
            </ons-toolbar-button>
        </right-content>
    </generic-toolbar>


    <loading-spinning-circle ng-if="tests.loading" loading-message="{{'LOADINGLABRESULTS'|translate}}">
    </loading-spinning-circle>
    <div class="navigation-bar" ng-if="!tests.loading">
        <div class="navigation-bar__center">
            <div class="button-bar" style="margin-top:10px;width:70%;left:15%;" >
                <div class="button-bar__item" ng-click="tests.checkForRefresh()">
                    <input type="radio" name="navi-segment-a" checked ng-model="tests.showByDate" ng-value="true">
                    <div class="button-bar__button">{{'LAB_BYDATE'|translate}}</div>
                </div>

                <div class="button-bar__item" ng-click="tests.checkForRefresh()">
                    <input type="radio" name="navi-segment-a" ng-model="tests.showByDate" ng-value="false">
                    <div class="button-bar__button">{{'LAB_BYTYPE'|translate}}</div>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="!tests.loading && tests.showContent">

        <!-- DISCLAIMER -->
        <labs-disclaimer></labs-disclaimer>

        <div ng-show="tests.showByDate">
            <ons-scroller-height>
                <div ng-if="tests.testDates.length === 0" style="margin-top: 25px; text-align: center;">
                    <p ng-class="fontSizeTitle">
                        {{"LAB_RESULTS_NONE"|translate}}
                    </p>
                </div>
                <div ng-if="tests.testDates.length > 0">
                    <ons-list>
                        <div ng-repeat="testDate in tests.testDates">
                            <ons-list-header ng-if="tests.showDateHeader($index)"
                                             ng-class="fontSizeTitle">{{testDate|date:'longDate'}}
                            </ons-list-header>
                            <ons-list-item
                                    ng-click="tests.goToTestDateResults(testDate)"
                                    modifier="chevron tappable" class="list-item-container">
                                <ons-row align="center">
                                    <ons-col width="60px" align="center">
                                        <div style="margin-left:10px">
                                            <ons-icon icon="ion-erlenmeyer-flask" style="color:#8BC34A" size="2x"></ons-icon>
                                        </div>
                                    </ons-col>
                                    <ons-col style="word-wrap: break-word;">
                                        <div style="line-height:1;">
                                            <p class="item-desc" ng-class="fontSizeDesc">
                                                {{"ADDED"|translate}}
                                                {{testDate | date:'shortTime'}}
                                            </p>
                                        </div>
                                    </ons-col>
                                </ons-row>
                            </ons-list-item>
                        </div>
                    </ons-list>

                </div>
            </ons-scroller-height>
        </div>
        <div ng-if="!tests.showByDate">
            <!-- NO LAB RESULTS MESSAGE -->
            <div ng-if="tests.testTypes.length === 0" style="margin-top: 25px; text-align: center;">
                <p ng-class="fontSizeTitle">
                    {{"LAB_RESULTS_NONE"|translate}}
                </p>
            </div>
            <div ng-if="tests.testTypes.length > 0">
                <div style="position:sticky; top:0; z-index:9999;">
                    <!-- SEARCH BAR -->
                    <search-bar search-text="tests.searchTestTypeText" placeholder="{{'SEARCH'|translate}}" style-class="fontSizeDesc"></search-bar>
                    <!-- HEADER WITH COLUMN TITLES -->
                    <ons-list>
                        <ons-list-item class="list-item-container">
                            <ons-row ng-class="fontSizeDesc" style="font-weight:bold" vertical-align="center">

                                <!-- HEADER - LEFT (NAME) -->
                                <ons-col width="35%" class="labtest-col hyphens" vertical-align="center">
                                    <div align="left" style="margin-left:4px">
                                        {{"LAB_NAME"|translate}}
                                    </div>
                                </ons-col>

                                <!-- HEADER - CENTRE (VALUE) -->
                                <ons-col width="25%" class="labtest-col hyphens" vertical-align="center">
                                    <div align="center">
                                        {{"LAB_RECENT_RESULT"|translate}}
                                    </div>
                                </ons-col>

                                <!-- HEADER - RIGHT (NORMAL RANGE) -->
                                <ons-col width="33%" class="labtest-col hyphens" vertical-align="center">
                                    <div align="right">
                                        {{"LAB_NORM"|translate}}
                                    </div>
                                </ons-col>

                                <!-- HEADER - SPACE FOR CHEVRON -->
                                <ons-col width="5%" class="labtest-col" vertical-align="center">
                                    <div align="right"></div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                    </ons-list>
                </div>
                <ons-scroller-height>
                    <ons-list>
                        <ons-list-item 
                        modifier="tappable chevron"
                        ng-repeat="testResult in tests.testTypes | filter: tests.searchTestTypeText"
                        ng-click="tests.goToTestTypeResults(testResult.testExpressionSerNum)"
                        class="list-item-container">
                            <ons-row ng-class="[tests.getTestClass(testResult), fontSizeDesc]" vertical-align="center">
                                <!-- LAB RESULT - LEFT (NAME) -->
                                <ons-col width="35%" class="labtest-col" vertical-align="center">
                                    <div align="left" style="margin-left:4px;">
                                        <p class="hyphens">{{tests.displayType(testResult)}}</p>
                                    </div>
                                </ons-col>

                                <!-- LAB RESULT - CENTRE (VALUE) -->
                                <ons-col width="25%" class="labtest-col" vertical-align="center">
                                    <div align="center">
                                        {{testResult.latestTestValue}}
                                        <span ng-if="testResult.latestAbnormalFlag">
                                            ({{testResult.latestAbnormalFlag}})
                                        </span>
                                        <div class="break-words">{{testResult.unitWithBrackets}}</div>
                                    </div>
                                </ons-col>

                                <!-- LAB RESULT - RIGHT (NORMAL RANGE) -->
                                <ons-col width="33%" class="labtest-col" vertical-align="center">
                                    <div align="right">
                                        {{testResult.normalRange}}
                                        <div ng-if="testResult.normalRange" class="break-words">{{testResult.unitWithBrackets}}</div>
                                    </div>
                                </ons-col>

                                <!-- LAB RESULT - SPACE FOR CHEVRON -->
                                <ons-col width="5%" class="labtest-col" vertical-align="center">
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                    </ons-list>
                </ons-scroller-height>
            </div>
        </div>
    </div>

</ons-page>
