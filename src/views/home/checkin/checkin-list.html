<ons-page ng-controller="CheckInController as checkIn">
    <generic-toolbar title="{{'CHECKIN'|translate}}" style-class="fontSizeTitle"></generic-toolbar>
    <network-banner></network-banner>
    <ons-list ng-repeat="(patientSerNum, value) in checkIn.displayApps">
        <ons-list-header class="person-list-header" ng-class="fontSizeTitle" style="padding:10px;">
            {{value.patientName}}
        </ons-list-header>
        <ons-list-item modifier="tappable" ng-repeat="app in value.apps">

            <!-----------------------------------------------------------------
            There is an ERROR when:
                checkIn.alert.type contains a value, regardless of the value
                  AND
                app.Checkin == 0  (i.e. Checkin failed)
            ------------------------------------------------------------------->

            <ons-row>
                <ons-col width="25%" align="center" style="text-align: center;">
                    {{app.ScheduledStartTime | date:'shortTime'}}
                    <svg ng-if="app.loading" class="progress-circular-sm">
                        <circle class="progress-circular__primary" cx="50%" cy="50%" r="40%" fill="none"
                                stroke-width="10%"
                                stroke-miterlimit="10"/>
                    </svg>
                    <i ng-if="app.CheckInStatus == 'success'" class="fa fa-check-square-o fa-2x"
                       style="color:#4CAF50;"></i>
                    <i ng-if="app.CheckInStatus == 'danger'" class="fa fa-times-circle fa-2x color-error"></i>
                </ons-col>
                <ons-col width="1%" > <div class="{{checkIn.separatorStatus[app.CheckInStatus]}}"></div></ons-col>
                <ons-col>
                    <div class="appointment-content">
                        <span ng-class="fontSizeTitle">
                            <p ng-if="checkIn.HasMeaningfulAlias(app['AppointmentType_' + checkIn.language])">
                                {{app["AppointmentType_" + checkIn.language]}}
                            </p>
                            <p ng-if="!checkIn.HasMeaningfulAlias(app['AppointmentType_' + checkIn.language])">
                                {{app["ResourceDescription"]}}
                            </p>

                        </span>
                        <p ng-show="app.RoomLocation_EN" class="item-desc" ng-class="fontSizeDesc" >
                            {{app["RoomLocation_" + checkIn.language]}}
                        </p>

                        <p ng-if="app.CheckinPossible == 0" class="item-desc" ng-class="fontSizeDesc" style="color:#FF803E;"
                           ng-bind-html="app['CheckinInstruction_' + checkIn.language] | trustHTML">
                        </p>

                        <p></p>

                        <!-- Successful Checkin -->
                        <div ng-if="app.Checkin == 1 && app.CheckinPossible == 1">
                            <span class="item-desc" ng-class="fontSizeDesc">
                                {{"CHECKED_IN"|translate}}
                            </span>

                            <span class="item-desc" ng-class="fontSizeDesc"
                                  ng-bind-html="app['CheckinInstruction_' + checkIn.language] | trustHTML">
                            </span>
                        </div>

                        <!-- Show the waiting Room when: Non-Checkinable appointment OR Successful Checked-in Appointment -->
                        <div ng-if="app.CheckinPossible == 0 || (checkIn.alert.type && app.Checkin == 1 && app.CheckinPossible == 1)">
                            <p></p>
                            <p class="item-desc" ng-class="fontSizeDesc" ng-show="app.MapName_EN">
                                {{"WAITING_ROOM"|translate}} {{app["MapName_" + checkIn.language]}}
                            </p>
                        </div>

                        <!-- An Error Occurred - Unsuccessful Checkin -->
                        <div ng-if="app.CheckInStatus == 'danger'">
                            <span class="item-desc color-error" ng-class="fontSizeDesc">
                                {{"CHECKIN_ERROR"|translate}}
                            </span>
                        </div>
                    </div>
                </ons-col>
            </ons-row>
        </ons-list-item>
        <ons-list-item ng-if="!value.allCheckedIn" class="item-btn">
            <ons-button ng-class="fontSizeTitle" class="checkin-btn"
                        ng-click="checkIn.CheckInAppointments(patientSerNum)">{{"CHECKINALLTODAY"|translate}}</ons-button>
        </ons-list-item>
    </ons-list>
    <ons-list ng-show="checkIn.emptyApps">
        <ons-list-header class="person-list-header" ng-class="fontSizeTitle" style="padding:10px;">
            No appointments today
        </ons-list-header>
    </ons-list>


    <!-- If there is an ERROR, the following will show an error message. -->
    <!-- This Code may never be executed because checkIn.error may never return ERROR because of changes to the Listener
         that do not return an ERROR anymore.
         We assume there is an error when:
                checkIn.alert.type contains a value, regardless of the value
                  AND
                app.Checkin == 0  (i.e. Checkin failed)
         -->

    <ons-list ng-if="checkIn.error">
        <ons-list-item>
            <ons-row>
                <ons-col width="50px" align="center" style="text-align: center;">
                    <i ng-if="checkIn.error" class="fa fa-times-circle fa-2x" style="color:red;"></i>
                </ons-col>

                <ons-col>
                    <p ng-if="checkIn.error" style="color: red;" class="item-desc" ng-class="fontSizeDesc">
                        {{"CHECKIN_ERROR"|translate}}
                    </p>
                </ons-col>
            </ons-row>
        </ons-list-item>
    </ons-list>
</ons-page>
