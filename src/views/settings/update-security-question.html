<!--
SPDX-FileCopyrightText: Copyright (C) 2020 Opal Health Informatics Group at the Research Institute of the McGill University Health Centre <john.kildea@mcgill.ca>

SPDX-License-Identifier: Apache-2.0
-->

<ons-page style="background-color: white" ng-controller="UpdateSecurityQuestionController as vm">
    <generic-toolbar title="{{'SECURITY_QUESTIONS'|translate}}" style-class="fontSizeTitle"></generic-toolbar>

    <!-- LOADING CIRCLE-->
    <loading-spinning-circle ng-show="vm.loadingList" loading-message="{{'LOADING_DATA'|translate}}"></loading-spinning-circle>

    <form class="container" ng-show="!vm.loadingList" novalidate>
        <!-- OVERALL INSTRUCTION -->
        <div class="update-security-question--spacing">
            <p ng-class="fontSizeTitle">{{"SECURITY_QUESTIONS_INSTRUCTIONS"|translate}}</p>
            <p ng-class="fontSizeDesc">{{"SECURITY_QUESTION_LOGOUT_WARNING"|translate}}</p>
        </div>

        <!-- INSTRUCTION FOR PASSWORD VERIFICATION -->
        <div>
            <p ng-class="fontSizeTitle">{{"ENTER_PASSWORD"|translate}}</p>
        </div>

        <!-- PASSWORD VERIFICATION -->
        <div class="change-password--div style-4" style="width: 100%;">
            <password-input>
                <input
                minlength="1"
                type="password"
                ng-class="fontSizeDesc"
                placeholder="{{'PASSWORD'|translate}}"
                ng-model="vm.password"
                ng-change="vm.passwordChanged = true; vm.evaluateSubmission();">
            </password-input>
        </div>

        <!-- SECURITY QUESTIONS 1 to 3 -->
        <div ng-repeat="$questionIndex in [0, 1, 2]" class="update-security-question--spacing">
            <div>
                <p ng-class="fontSizeTitle">{{"QUESTION"|translate}} {{$questionIndex + 1}}</p>
            </div>
            <!-- DROPDOWN TO SELECT A QUESTION -->
            <div class="dropdown">
                <select class="update-security-question--dropdown" ng-class="fontSizeDesc"
                        ng-model="vm['question' + $questionIndex]" ng-change="vm.changeSecurityQuestion($questionIndex, vm['question' + $questionIndex])">
                    <!-- DROPDOWN MENU OPTIONS (THE QUESTION CHOICES) -->
                    <option ng-repeat="activeQuestion in vm.activeSecurityQuestionList"
                            id="{{'question-'+ $questionIndex +'-option-' + $index}}" value="{{$index}}"
                            class="update-security-question--option" ng-class="fontSizeDesc">
                        {{vm.displayQuestionName(activeQuestion)}}
                    </option>
                </select>
            </div>
            <!-- ANSWER FIELD -->
            <div class="style-4" style="width: 100%;">
                <input type="text" class="update-security-answer--input" ng-class="fontSizeDesc"
                       placeholder="{{vm.securityQuestionWithAnsList[$questionIndex].oldAnswerPlaceholder}}"
                       ng-model="vm.securityQuestionWithAnsList[$questionIndex].answer" style="margin-top: 2%"
                       ng-change="vm.securityQuestionAnswerChanged(vm.securityQuestionWithAnsList[$questionIndex]);">
            </div>
            <!-- ERROR STRING (ANSWER LENGTH) -->
            <div ng-show="vm.securityQuestionWithAnsList[$questionIndex].answer.length < vm.min_answer_len && vm.securityQuestionWithAnsList[$questionIndex].answerHasChanged"
                 style="color: crimson">
                {{"SECURITY_QUESTION_LENGTH_REQUIREMENT_1"|translate}} {{vm.min_answer_len}} {{"SECURITY_QUESTION_LENGTH_REQUIREMENT_2"|translate}}
            </div>
            <!-- ERROR STRING (DUPLICATE QUESTION) -->
            <div ng-show="vm.questionAlreadyUsed($questionIndex)"
                 style="color: crimson">
                {{"SECURITY_QUESTION_ALREADY_USED"|translate}}
            </div>
        </div>

        <!-- SUBMIT BUTTON -->
        <div align="center" class="update-security-question--spacing">
            <button id="update-security-question-submit-btn" class="button--large--cta" style="width:80%; white-space: initial;" ng-click="vm.submit();" ng-class="fontSizeDesc"
                    ng-disabled="vm.submitDisabled">{{"SUBMIT_AND_LOGOUT"|translate}}
            </button>
        </div>
    </form>
</ons-page>
